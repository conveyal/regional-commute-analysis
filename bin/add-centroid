#!/usr/bin/env node

var args = require('minimist')(process.argv.slice(2));

var debug = require('debug')('regional-commute-analysis:add-centroid');
var fs = require('fs');

var inputFile = args._[0];
var outputFile = args._[1];

var data = !fs.existsSync(outputFile)
  ? {}
  : JSON.parse(fs.readFileSync(outputFile, { encoding: 'utf8' }));

var file = fs.readFileSync(inputFile, { encoding: 'utf8' });
var lines = file.split('\n');
var cols = lines.pop().split(',');

for (var i = 1; i < lines.length; i++) {
  var line = lines[i].split(',');

  // FIPS ID
  data[line[7]] = [
    parseFloat(line[16]), // lon
    parseFloat(line[15]), // lat
    parseInt(line[7]) // FIPS ID
  ];
}

debug('extracted ' + lines.length + ' FIPS lat/lon points from ' + inputFile);

fs.writeFileSync(outputFile, JSON.stringify(data, null, '\t'), { encoding: 'utf8' });
